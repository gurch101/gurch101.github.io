<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Advanced Learning Algorithms | Gurchet&#x27;s Development Blog</title><meta name="description" content="Coursera ML Specialization Course 2 Notes"/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/549468e6bf83b511.css" as="style"/><link rel="stylesheet" href="/_next/static/css/549468e6bf83b511.css" data-n-g=""/><link rel="preload" href="/_next/static/css/4634d28b7f97c8b5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4634d28b7f97c8b5.css" data-n-p=""/><noscript data-n-css=""></noscript></head><body><div id="__next"><div class="container"><div><h1 class="mb3">Advanced Learning Algorithms</h1><div class="meta"><span>Thu Jan 14 2021</span><span>notes</span></div><div class="mt25 post"><h1>Advanced Learning Algorithms</h1>
<p>Neural networks</p>
<ul>
<li>inference/prediction</li>
<li>training</li>
<li>practical advice
Decision trees</li>
</ul>
<p>Neural networks - algorithms that try to mimic the brain using simplified mathematical models of a neuron
Used for handwriting, speech recognition, image recognition, natural language processing</p>
<p>A neural network has layers of neurons. Each neuron takes an input vector and outputs a single value.</p>
<p>Can be thought of as logistic regression where each layer learns its own features. For example, in demand prediction,
inputs could be price, shipping cost, marketing, material, output layer could engineer its own features of affordability, awareness, and perceived quality, which is then fed to another layer to output another set of features.</p>
<p>For image recognition, pixel intensities are fed as a vector. Each layer indentifies increasingly complex features - lines, shapes, eyes/ears, etc.</p>
<p><img src="/images/nnlayer.png" alt="Neural Network Layer"></p>
<p>Forward propagation = prediction
Backward propagation = learning</p>
<p>Forward propagation in Python</p>
<div class="remark-highlight"><pre class="language-py"><code class="language-py">x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
w1_1 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b1_1 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
z1_1 <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w1_1<span class="token punctuation">,</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> b1_1
a1_1 <span class="token operator">=</span> sigmoid<span class="token punctuation">(</span>z1_1<span class="token punctuation">)</span>

w1_2 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b1_2 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
z1_2 <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w1_2<span class="token punctuation">,</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> b1_2
a1_2 <span class="token operator">=</span> sigmoid<span class="token punctuation">(</span>z1_2<span class="token punctuation">)</span>

w1_3 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b1_3 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
z1_3 <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w1_3<span class="token punctuation">,</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> b1_3
a1_3 <span class="token operator">=</span> sigmoid<span class="token punctuation">(</span>z1_3<span class="token punctuation">)</span>

a1 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>a1_1<span class="token punctuation">,</span> a1_2<span class="token punctuation">,</span> a1_3<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># generic implementation</span>
<span class="token keyword">def</span> <span class="token function">dense</span><span class="token punctuation">(</span>a_in<span class="token punctuation">,</span> W<span class="token punctuation">,</span> b<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">"""</span>
<span class="token triple-quoted-string string">  Computes dense layer</span>
<span class="token triple-quoted-string string">  Args:</span>
<span class="token triple-quoted-string string">    a_in (ndarray (n, )) : Data, 1 example</span>
<span class="token triple-quoted-string string">    W    (ndarray (n,j)) : Weight matrix, n features per unit, j units</span>
<span class="token triple-quoted-string string">    b    (ndarray (j, )) : bias vector, j units</span>
<span class="token triple-quoted-string string">    g    activation function (e.g. sigmoid, relu..)</span>
<span class="token triple-quoted-string string">  Returns</span>
<span class="token triple-quoted-string string">    a_out (ndarray (j,))  : j units|</span>
<span class="token triple-quoted-string string">  """</span>
  units <span class="token operator">=</span> W<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># rows = number of features, columns = units</span>
  a_out <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>units<span class="token punctuation">)</span>
  <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>units<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># if a,w,b were matrices, this loop could be replaced with Z = np.matmul(A_in,W) + b</span>
    w <span class="token operator">=</span> W<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>j<span class="token punctuation">]</span>
    z <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w<span class="token punctuation">,</span> a_in<span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
    a_out<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> g<span class="token punctuation">(</span>z<span class="token punctuation">)</span>
  <span class="token keyword">return</span> a_out


<span class="token keyword">def</span> <span class="token function">sequential</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> W1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> W2<span class="token punctuation">,</span> b2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a1 <span class="token operator">=</span> dense<span class="token punctuation">(</span>x<span class="token punctuation">,</span>  W1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> sigmoid<span class="token punctuation">)</span>
    a2 <span class="token operator">=</span> dense<span class="token punctuation">(</span>a1<span class="token punctuation">,</span> W2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> sigmoid<span class="token punctuation">)</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span>
</code></pre></div>
<h3>Tensorflow</h3>
<p>Machine learning package from Google. Keras creates a simple, layer-centric interface to Tensorflow.</p>
<p><img src="/images/tensorflowinference.png" alt="Tensorflow Inference"></p>
<div class="remark-highlight"><pre class="language-py"><code class="language-py"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Dense<span class="token punctuation">,</span> Input
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> Sequential
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses <span class="token keyword">import</span> MeanSquaredError<span class="token punctuation">,</span> BinaryCrossentropy
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>activations <span class="token keyword">import</span> sigmoid
<span class="token keyword">import</span> logging
logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">"tensorflow"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>autograph<span class="token punctuation">.</span>set_verbosity<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>


X_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>           <span class="token comment">#(size in 1000 square feet)</span>
Y_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">300.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">500.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>       <span class="token comment">#(price in 1000s of dollars)</span>


<span class="token comment"># layer with one neuron using linear regression</span>
linear_layer <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span>units<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token comment"># initializes weights to random values. Tensorflow requires 2d matrices</span>
linear_layer<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
w<span class="token punctuation">,</span> b<span class="token operator">=</span> linear_layer<span class="token punctuation">.</span>get_weights<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"w = </span><span class="token interpolation"><span class="token punctuation">{</span>w<span class="token punctuation">}</span></span><span class="token string">, b=</span><span class="token interpolation"><span class="token punctuation">{</span>b<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

set_w <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
set_b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># set_weights takes a list of numpy arrays</span>
linear_layer<span class="token punctuation">.</span>set_weights<span class="token punctuation">(</span><span class="token punctuation">[</span>set_w<span class="token punctuation">,</span> set_b<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># both produce identical values. a1 is a tensor. To convert back to a numpy array, call a1.numpy()</span>
a1 <span class="token operator">=</span> linear_layer<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span>
alin <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>set_w<span class="token punctuation">,</span>X_train<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> set_b
<span class="token keyword">print</span><span class="token punctuation">(</span>alin<span class="token punctuation">)</span>

prediction_tf <span class="token operator">=</span> linear_layer<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
prediction_np <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span> X_train<span class="token punctuation">,</span> set_w<span class="token punctuation">)</span> <span class="token operator">+</span> set_b


<span class="token comment"># Sequential is a list of nn layers</span>
model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> input_dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>  activation <span class="token operator">=</span> <span class="token string">'sigmoid'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'L1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token comment"># prints layers, type, shape, params</span>
model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>

logistic_layer <span class="token operator">=</span> model<span class="token punctuation">.</span>get_layer<span class="token punctuation">(</span><span class="token string">'L1'</span><span class="token punctuation">)</span>
w<span class="token punctuation">,</span>b <span class="token operator">=</span> logistic_layer<span class="token punctuation">.</span>get_weights<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>b<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

a1 <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span>

<span class="token comment"># normalize the data</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Temperature Max, Min pre normalization: </span><span class="token interpolation"><span class="token punctuation">{</span>np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">0.2f</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">0.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Duration    Max, Min pre normalization: </span><span class="token interpolation"><span class="token punctuation">{</span>np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">0.2f</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">0.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
norm_l <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Normalization<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
norm_l<span class="token punctuation">.</span>adapt<span class="token punctuation">(</span>X<span class="token punctuation">)</span>  <span class="token comment"># learns mean, variance</span>
Xn <span class="token operator">=</span> norm_l<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Temperature Max, Min post normalization: </span><span class="token interpolation"><span class="token punctuation">{</span>np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>Xn<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">0.2f</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>Xn<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">0.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Duration    Max, Min post normalization: </span><span class="token interpolation"><span class="token punctuation">{</span>np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>Xn<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">0.2f</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>Xn<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">0.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>set_seed<span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>  <span class="token comment"># applied to achieve consistent results</span>
model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Input<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Dense<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'sigmoid'</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'layer1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'sigmoid'</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'layer2'</span><span class="token punctuation">)</span>
     <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>
    loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>BinaryCrossentropy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># run gradient descent</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>
    Xt<span class="token punctuation">,</span>Yt<span class="token punctuation">,</span>
    epochs<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># model.compile/model.fit(x,y) to train the model</span>
</code></pre></div>
<h3>Train a 0/1 Digit Recognizer</h3>
<div class="remark-highlight"><pre class="language-py"><code class="language-py"><span class="token comment">### Data Viz</span>
m<span class="token punctuation">,</span> n <span class="token operator">=</span> X<span class="token punctuation">.</span>shape

fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span>pad<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axes<span class="token punctuation">.</span>flat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Select random indices</span>
    random_index <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>m<span class="token punctuation">)</span>

    <span class="token comment"># Select rows corresponding to the random indices and</span>
    <span class="token comment"># reshape the image</span>
    X_random_reshaped <span class="token operator">=</span> X<span class="token punctuation">[</span>random_index<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T

    <span class="token comment"># Display the image</span>
    ax<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>X_random_reshaped<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>

    <span class="token comment"># Display the label above the image</span>
    ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span>y<span class="token punctuation">[</span>random_index<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">### Train the model</span>
model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Input<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">"sigmoid"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">"sigmoid"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">"sigmoid"</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"my_model"</span>
<span class="token punctuation">)</span>

model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>
    loss<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>BinaryCrossentropy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>
    X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>
    epochs<span class="token operator">=</span><span class="token number">20</span>
<span class="token punctuation">)</span>

<span class="token comment">### Visualize the results</span>

m<span class="token punctuation">,</span> n <span class="token operator">=</span> X<span class="token punctuation">.</span>shape

fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span>pad<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.03</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.92</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#[left, bottom, right, top]</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span>ax <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>axes<span class="token punctuation">.</span>flat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Select random indices</span>
    random_index <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>m<span class="token punctuation">)</span>

    <span class="token comment"># Select rows corresponding to the random indices and</span>
    <span class="token comment"># reshape the image</span>
    X_random_reshaped <span class="token operator">=</span> X<span class="token punctuation">[</span>random_index<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T

    <span class="token comment"># Display the image</span>
    ax<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>X_random_reshaped<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>

    <span class="token comment"># Predict using the Neural Network</span>
    prediction <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">[</span>random_index<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> prediction <span class="token operator">>=</span> <span class="token number">0.5</span><span class="token punctuation">:</span>
        yhat <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        yhat <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment"># Display the label above the image</span>
    ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>y<span class="token punctuation">[</span>random_index<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>yhat<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">"Label, yhat"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<h3>Decision Trees</h3>
<div class="remark-highlight"><pre class="language-py"><code class="language-py"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeRegressor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_absolute_error
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split

data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
<span class="token comment"># get percentiles, mean, std of each column</span>
data<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># list all columns</span>
data<span class="token punctuation">.</span>columns

<span class="token comment"># get predictive column</span>
y <span class="token operator">=</span> data<span class="token punctuation">.</span>Price

<span class="token comment"># get features</span>
X <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Rooms'</span><span class="token punctuation">,</span> <span class="token string">'Bathroom'</span><span class="token punctuation">.</span> <span class="token string">'Landsize'</span><span class="token punctuation">]</span>

<span class="token comment"># show first bunch of rows</span>
X<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

train_X<span class="token punctuation">,</span> val_X<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> val_y <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> random_state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_mae</span><span class="token punctuation">(</span>max_leaf_nodes<span class="token punctuation">,</span> train_X<span class="token punctuation">,</span> val_X<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> val_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># random_state ensures same results for each run, max_leaf_nodes is used to control tree depth</span>
    <span class="token comment"># too deep = overfitting, too shallow = underfitting</span>
    model <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> max_leaf_nodes<span class="token operator">=</span>max_leaf_nodes<span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
    preds_val <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>val_X<span class="token punctuation">)</span>
    <span class="token comment"># abs(predicted - actual) / N</span>
    mae <span class="token operator">=</span> mean_absolute_error<span class="token punctuation">(</span>val_y<span class="token punctuation">,</span> preds_val<span class="token punctuation">)</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>mae<span class="token punctuation">)</span>

candidate_max_leaf_nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">]</span>
<span class="token comment"># Write loop to find the ideal tree size from candidate_max_leaf_nodes</span>
scores <span class="token operator">=</span> <span class="token punctuation">{</span> leaf_size<span class="token punctuation">:</span> get_mae<span class="token punctuation">(</span>leaf_size<span class="token punctuation">,</span> train_X<span class="token punctuation">,</span> val_X<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> val_y<span class="token punctuation">)</span> <span class="token keyword">for</span> leaf_size <span class="token keyword">in</span> candidate_max_leaf_nodes<span class="token punctuation">}</span>

<span class="token comment"># Store the best value of max_leaf_nodes (it will be either 5, 25, 50, 100, 250 or 500)</span>
best_tree_size <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>scores<span class="token punctuation">,</span> key<span class="token operator">=</span>scores<span class="token punctuation">.</span>get<span class="token punctuation">)</span>

<span class="token comment"># now that all param decisions are made, fit to entire dataset</span>
final_model <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>max_leaf_nodes<span class="token operator">=</span>best_tree_size<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

final_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

</code></pre></div>
<h3>Random Forests</h3>
<p>A random forest uses many trees and makes predictions by averaging the prediction of each tree</p>
<div class="remark-highlight"><pre class="language-py"><code class="language-py"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestRegressor
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_absolute_error

forest_model <span class="token operator">=</span> RandomForestRegressor<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
forest_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span>
melb_preds <span class="token operator">=</span> forest_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>val_X<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mean_absolute_error<span class="token punctuation">(</span>val_y<span class="token punctuation">,</span> melb_preds<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<h3>Questions</h3>
<p>Why do neural networks use the sigmoid function? why not just raw vaules like linear regression?</p>
</div></div></div></div></body></html>