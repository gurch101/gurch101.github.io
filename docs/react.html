<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>React | Gurchet&#x27;s Development Blog</title><meta name="description" content="React Summary"/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/51dd2ece2d2e2902880b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/51dd2ece2d2e2902880b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/da823d5520371b52ce1f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/da823d5520371b52ce1f.css" data-n-p=""/><noscript data-n-css=""></noscript></head><body><div id="__next"><div class="container"><div><h1 class="mb3">React</h1><div class="meta"><span>Sat Oct 02 2021</span><span>summary</span></div><div class="mt25 post"><h3>Components</h3>
<p>A component that accepts props and returns a description of its UI</p>
<h3>Tips</h3>
<ul>
<li>favor functional components since they have no lifecycle methods, constructors, or boilerplate.</li>
<li>always name components/functions since it helps when reading the error stack</li>
<li>rather than hardcoding markup, use const config objects and loops</li>
<li>use <code>ErrorBoundary</code> to avoid cascading failures</li>
<li>the more props a component takes, the more reasons to re-render</li>
<li>if a component has multiple pieces of state, use <code>useReducer</code> instead of multiple <code>useState</code> calls</li>
</ul>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">TYPES</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">SMALL</span><span class="token operator">:</span> <span class="token string">'small'</span><span class="token punctuation">,</span>
  <span class="token constant">MEDIUM</span><span class="token operator">:</span> <span class="token string">'medium'</span><span class="token punctuation">,</span>
  <span class="token constant">LARGE</span><span class="token operator">:</span> <span class="token string">'large'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  isOpen<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">LARGE</span><span class="token punctuation">,</span>
  phone<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  email<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  error<span class="token operator">:</span> <span class="token keyword null nil">null</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token spread operator">...</span>
    <span class="token keyword module">default</span><span class="token operator">:</span>
      <span class="token keyword control-flow">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token spread operator">...</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<ul>
<li>group components by route/module rather than container/component. State should live close to the component using it. Container/component model encourages few components to hold most state. Put UI components in a common module.</li>
<li>use absolute paths instead of relative paths to enable easy project structure changes.</li>
<li>watch the bundle size. Don't ship a single JS bundle. Split by route.</li>
</ul>
<h3>SWR</h3>
<p>Data is bound to the components that need the data, components are independent of one another. Only 1 request is sent to the API - SWR caches by key, request is deduped, cached, and shared automatically.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">fetcher</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token spread operator">...</span>args</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token spread operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token arrow operator">=></span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">useUser</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> fetcher<span class="token punctuation">)</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    user<span class="token operator">:</span> data<span class="token punctuation">,</span>
    isLoading<span class="token operator">:</span> <span class="token operator">!</span>error <span class="token operator">&#x26;&#x26;</span> <span class="token operator">!</span>data<span class="token punctuation">,</span>
    isError<span class="token operator">:</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// page component</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Navbar</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Content</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">// child components</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Navbar</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
    <span class="token spread operator">...</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Avatar</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Content</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> isLoading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Spinner</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Welcome</span> back<span class="token punctuation">,</span> <span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Avatar</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> isLoading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Spinner</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">avatar</span><span class="token punctuation">}</span> alt<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">/*</span>
<span class="token comment">if fetcher needs multiple args,</span>
<span class="token comment">useSWR(['/api/user', token], fetchWithToken)</span>
<span class="token comment">const { data: orders } = useSWR({ url: '/api/orders', args: user }, fetcher)</span>
<span class="token comment">*/</span>

<span class="token keyword module">import</span> <span class="token imports">useSWR</span> <span class="token keyword module">from</span> <span class="token string">'swr'</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> mutate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">,</span> fetcher<span class="token punctuation">)</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">My</span> name is <span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> newName <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token method function property-access">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// send a request to the API to update the data</span>
        <span class="token keyword control-flow">await</span> <span class="token function">requestUpdateUsername</span><span class="token punctuation">(</span>newName<span class="token punctuation">)</span>
        <span class="token comment">// update the local data immediately and revalidate (refetch)</span>
        <span class="token comment">// NOTE: key is not required when using useSWR's mutate as it's pre-bound</span>
        <span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token spread operator">...</span>data<span class="token punctuation">,</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Uppercase</span> my name<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>Prefetching Data</h3>
<p>Prefetch when the HTML loads.</p>
<div class="remark-highlight"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/api/data<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fetch<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>head</span><span class="token punctuation">></span></span>
</code></pre></div>
<h3>React Router</h3>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Router</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Link</span> to<span class="token operator">=</span><span class="token string">"/foo"</span><span class="token operator">></span><span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Link</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Routes</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Route</span> path<span class="token operator">=</span><span class="token string">"/foo"</span> element<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">FooPage</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Routes</span><span class="token operator">></span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token maybe-class-name">Router</span><span class="token operator">></span>
</code></pre></div>
<h3>useState</h3>
<p>When state changes, react needs to run the component functions that use that state. This differs from the class-based setState - in classes, setState accepts an object with just the properties you want to update and then merges them with the rest. The useState hook replaces the previous state value with the new value passed to the function.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialVal<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token function">setState</span><span class="token punctuation">(</span>someVal<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">latestState</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token spread operator">...</span>latestState<span class="token punctuation">,</span>
  someVal
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>If its expensive to set <code>initialVal</code>, pass a function to <code>useState</code></p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">someExpensiveFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>If you need to compute next state val from current state val, pass a function to <code>setState</code>.  We need to do this because React batches updates together to ignore redundant updates.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3>useReducer</h3>
<p>When multiple state values change together, use a reducer (ie ajax - loading/error/data). A reducer function accepts a state value and an action value and returns the new state value.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"SET_GROUP"</span><span class="token operator">:</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        group<span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">payload</span><span class="token punctuation">,</span>
        bookableIndex<span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">"SET_BOOKABLE"</span><span class="token operator">:</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        bookable<span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">payload</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">"NEXT_BOOKABLE"</span><span class="token operator">:</span>
      <span class="token keyword">const</span> count <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token property-access">bookables</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token arrow operator">=></span> b<span class="token punctuation">.</span><span class="token property-access">group</span> <span class="token operator">===</span> state<span class="token punctuation">.</span><span class="token property-access">group</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        bookableIndex<span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">bookableIndex</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> count
      <span class="token punctuation">}</span>
    <span class="token keyword module">default</span><span class="token operator">:</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  group<span class="token operator">:</span> <span class="token string">"Rooms"</span><span class="token punctuation">,</span>
  bookableIndex<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  hasDetails<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  bookables
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// alt: const { {group, bookableIndex, bookables, hasDetails }, dispatch } = useReducer(reducer, initialState);</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>group<span class="token punctuation">,</span> bookableIndex<span class="token punctuation">,</span> bookables<span class="token punctuation">,</span> hasDetails<span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">changeGroup</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">"SET_GROUP"</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// if initialState needs expensive computation, getInitialState is passed someVal and should return initialState</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> someVal<span class="token punctuation">,</span> getInitialState<span class="token punctuation">)</span>
</code></pre></div>
<h4>useEffect</h4>
<p>When your component has a side effect, use the <code>useEffect</code> hook. Called after rendering. Common side effects:</p>
<ul>
<li>interacting with dom directly</li>
<li>working with timers</li>
<li>using local storage</li>
<li>ajax</li>
</ul>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// run on every render</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// run on component mount only</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">handleResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setSize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      width<span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerWidth</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">innerHeight</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// called on unmount or if the effect runs again</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/api/users"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token arrow operator">=></span> resp<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token arrow operator">=></span> <span class="token function">setUsers</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// since react expects a cleanup function as a return value, use async internally</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/api/users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword control-flow">await</span> resp<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setUsers</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// run when dependencies change - deps can be props, state</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dep1<span class="token punctuation">,</span> dep2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3>useLayoutEffect</h3>
<p>Runs synchronously after React updates the DOM but before the browser repaints. Can be used to avoid flashes of changing state. Use in place of <code>useEffect</code> if you see FOUC.</p>
<h3>useRef</h3>
<p>if you need to update state without causing a re-render, <code>useRef</code>. Useful to store timer id's, DOM element references.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// ref.current will equal initialVal</span>
<span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>initialVal<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">incRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token operator">++</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> timerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  timerRef<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'NEXT_BOOKABLE'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timerRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> nextButtonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  nextButtonRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span>button ref<span class="token operator">=</span><span class="token punctuation">{</span>nextButtonRef<span class="token punctuation">}</span><span class="token operator">></span><span class="token constant">NEXT</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token punctuation">)</span>
</code></pre></div>
<h3>State Management</h3>
<p>When different components use the same data to build their UI, the most explicit way to share that data is to pass it as props from parent to child. It is common to lift state up to a common ancestor to make it more widely available.</p>
<h3>useCallback</h3>
<p>avoid redefining callbacks with the <code>useCallback</code> hook. Functions from useState/useReducer are guaranteed to have stable identity. By default, our own functions will be re-defined on every call to the component.</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> stableFunction <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>functionToCache<span class="token punctuation">,</span> <span class="token punctuation">[</span>depList<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3>useMemo</h3>
</div></div></div></div></body></html>